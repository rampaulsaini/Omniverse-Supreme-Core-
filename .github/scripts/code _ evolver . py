#!/usr/bin/env python3
# .github/scripts/code_evolver.py
import os, json, datetime

report_lines = []
report_lines.append("# CODE-EVOLVER-REPORT")
report_lines.append(f"Generated: {datetime.datetime.utcnow().isoformat()}Z")
report_lines.append("")
report_lines.append("Summary of simple heuristics checks:")

# Example check 1: presence of Dockerfile
if os.path.exists("backend/Dockerfile"):
    report_lines.append("- Dockerfile present: OK")
else:
    report_lines.append("- Dockerfile missing: consider adding one under backend/")

# Example check 2: frontend build script
if os.path.exists("frontend/package.json"):
    try:
        pj = json.load(open("frontend/package.json"))
        if "build" in pj.get("scripts",{}):
            report_lines.append("- frontend build script found: OK")
        else:
            report_lines.append("- frontend build script missing: consider adding `npm run build` script")
    except Exception:
        report_lines.append("- frontend/package.json parse error")
else:
    report_lines.append("- frontend/package.json not present")

# Example check 3: knowledge size
if os.path.exists("backend/data/knowledge.json"):
    try:
        data = json.load(open("backend/data/knowledge.json",encoding="utf-8"))
        report_lines.append(f"- knowledge entries: {len(data)} (target >= 200 for rich persona)")
    except Exception:
        report_lines.append("- knowledge.json parse error")
else:
    report_lines.append("- knowledge.json missing")

report_lines.append("")
report_lines.append("End of report.")

with open("CODE-EVOLVER-REPORT.md","w",encoding="utf-8") as f:
    f.write("\n".join(report_lines))

print("CODE-EVOLVER: report written")
